<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DÂ∑•ÂÖ∑ÂáΩÊï∞</title>
  <script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/prism/1.29.0/components/prism-batch.min.js"></script>
  <script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
  <script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/prism/1.29.0/components/prism-nginx.min.js"></script>
  <!-- <script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script> -->
  <!-- <link href="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet"> -->
  <!-- <link href="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/prism-themes/1.9.0/prism-vs.min.css" rel="stylesheet"> -->
  <link href="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/prism-themes/1.9.0/prism-vsc-dark-plus.min.css" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; }
    body { font-size: 14px; background: #f6f6f6;}
    a { text-decoration: none; color: #333; }
    i { font-style: normal; }
    a:hover { color: #409EFF; }
    .float-tools {  position: fixed; top: 10px; right: 10px; background-color: white; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 10px 10px 0; z-index: 1000; max-height: calc(100vh - 30px); overflow-y: auto; }
    .float-tools a { display: block; margin-bottom: 8px; }
    .tools { padding-bottom: 10px; text-align: right; }
    .tools i { border: 1px solid #dcdfe6; margin-left: 8px;  color: #606266; padding: 1px 4px; border-radius: 4px; line-height: 1; cursor: pointer; }
    pre[class*=language-] { margin: 0 0 8px; }
    code[class*=language-], pre[class*=language-] { font-size: 14px; tab-size: 2; }
    .title { padding-top: 8px; }
    .title-box { transition: all .3s; height: auto; overflow: hidden; }
    .spliter { margin: 0 0 6px 0; background: #409EFF; color: #fff; padding: 2px 6px; cursor: pointer; }
    ::-webkit-scrollbar {	width: 8px; height: 8px; }
    ::-webkit-scrollbar-thumb {	background-color: #ddd; border-radius: 6px; }
  </style>
</head>
<body>
  <div>
    <pre id="list-js">
      <code class="language-javascript" id="cont-js"></code>
    </pre>
    <pre id="list-batch">
      <code class="language-batch" id="cont-bat"></code>
    </pre>
    <pre id="list-bash">
      <code class="language-bash" id="cont-bash"></code>
    </pre>
    <pre id="list-nginx">
      <code class="language-nginx" id="cont-nginx"></code>
    </pre>
    <pre id="list-css">
      <code class="language-css" id="cont-css"></code>
    </pre>
  </div>
  <div class="float-tools" >
    <div class="tools">
      <i onclick="toggleTool()" style="opacity: .7;" title="ÂàáÊç¢Â∑•ÂÖ∑Ê†è">üëÅÔ∏è‚Äçüó®Ô∏è</i>
      <i onclick="toggleTheme()" id="tool-theme" title="ÂàáÊç¢‰∏ªÈ¢ò">üåô</i>
    </div>
    <div id="title-list"></div>
    <div style="position: fixed; background: rgba(255, 255, 255, 0.7); z-index: 6999; bottom: 10px; right: 10px; border: 1px solid #bbb; width: 24px; line-height: 24px; text-align: center; cursor: pointer; " onclick="window.scrollTo({ top: 0, behavior: 'smooth' })">‚Üë</div>
  </div>
  <!-- <script src="./javascript.js"></script> -->
  <script src="./bat.js"></script>
  <script src="./bash.js"></script>
  <script src="./nginx.js"></script>
  <script src="./css.js"></script>
<!-- ************************************************************* jsCont ************************************************************* -->
<script id="jsCont">
// # Êñá‰ª∂-ÊûÑÂª∫Êñá‰ª∂
function buildFile(text, type = 'text/plain') {
  const blob = new Blob([text], { type: type });
  const file = new File([blob], 'test.txt', { type: type });
}

// # Êñá‰ª∂-‰∏ãËΩΩBlob
// ÊñáÊú¨‰πüÂèØ new Blob([text], { type: 'text/plain;charset=utf-8' })
function download(blob, name) {
  if (window.navigator.msSaveOrOpenBlob) {
    navigator.msSaveBlob(blob, name)
  } else {
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = name;
    document.body.appendChild(link);
    link.click();
    URL.revokeObjectURL(url);
    setTimeout(() => link.remove(), 200);
  }
}

function downloadText1(text, name) {
  download(new Blob([text], { type: 'text/plain;charset=utf-8' }), name)
}

function downloadText(text, name) {
  const url = URL.createObjectURL(new Blob([text], { type: 'text/plain;charset=utf-8' }));
  const link = Object.assign(document.createElement('a'), { href: url, download: name });
  document.body.appendChild(link).click();
  link.remove();
  URL.revokeObjectURL(url);
}

// # Êñá‰ª∂-‰∏ãËΩΩÊñáÊú¨
function downloadText1(text, name) {
  const link = document.createElement('a');
  link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(text)
  link.download = name
  link.style.display = 'none'
  document.body.appendChild(link)
  link.click()
  document.body.removeChild(link)
}

// # Êñá‰ª∂-‰∏ÄÈîÆ‰∏ä‰º†Âπ∂Ëé∑ÂèñÊñáÊú¨ÂÜÖÂÆπ
function uploadText1() {
  return new Promise((res, rej) => {
    document.getElementById('importInput')?.remove()
    const inputEl = document.createElement('input')
    inputEl.type = 'file'
    inputEl.id = "importInput" 
    inputEl.style = "display: none;" 
    document.body.append(inputEl)
    inputEl.onchange = function () {
      const resultFile = inputEl.files[0]
      if (resultFile) {
        const reader = new FileReader()
        reader.readAsText(resultFile, 'UTF-8')
        reader.onload = () => {
            let obj = { name: resultFile.name, data: reader.result, size: resultFile.size, type: resultFile.type }
            document.body.removeChild(inputEl)
            try { obj.data = JSON.parse(obj.data) } catch(e) { }
            res(obj)
        }
      } else {
        document.body.removeChild(inputEl)
        res('')
      }
    }
    inputEl.click()
  })
}

function uploadText() {
  return new Promise((res) => {
    document.getElementById('impinput')?.remove()
    const inputEl = Object.assign(document.createElement('input'), { type: 'file', id: 'impinput', style: 'display: none;' })
    document.body.append(inputEl)
    inputEl.onchange = function () {
      const file = inputEl.files[0]
      if (!file) return res(null)
      const reader = new FileReader()
      reader.readAsText(file, 'UTF-8')
      reader.onload = () => res({ name: file.name, data: reader.result, size: file.size, type: file.type })
    }
    inputEl.click()
  })
}

// # Êñá‰ª∂-‰∏ÄÈîÆ‰∏ä‰º†Âπ∂Ëé∑ÂèñÂÜÖÂÆπ
function uploadCont(isBase46) {
  // ÊãºÊé•base64  data:image/jpeg;base64,XXXXXXXXXXXX
  return new Promise((res, rej) => {
    document.getElementById('importInput')?.remove()
    const inputEl = document.createElement('input')
    inputEl.type = 'file'
    inputEl.id = "importInput" 
    inputEl.style = "display: none;" 
    document.body.append(inputEl)
    inputEl.onchange = function () {
      const resultFile = inputEl.files[0]
      if (resultFile) {
        const reader = new FileReader()
        if (isBase46) {
          reader.readAsArrayBuffer(resultFile)
          reader.onload = () => {
            const arrayBuffer = reader.result;
            document.body.removeChild(inputEl)
            res({ name: resultFile.name, data: bufferToBase64(arrayBuffer), size: resultFile.size, type: resultFile.type })
          }
        } else {
          reader.readAsText(resultFile, 'UTF-8')
          reader.onload = () => {
              let fileContent = reader.result
              document.body.removeChild(inputEl)
              let obj = { name: resultFile.name, data: fileContent, size: resultFile.size, type: resultFile.type }
              try {
                obj.data = JSON.parse(fileContent)
              } catch(e) { }
              res(obj)
          }
        }
      } else {
        document.body.removeChild(inputEl)
        res('')
      }
    }
    inputEl.click()
  })
}

function bufferToBase64(buffer) {
  const arr = new Uint8Array(buffer)
  const chunkSize = 10000
  const chunks = []
  for (let i = 0; i < arr.length; i += chunkSize) {
    chunks.push(arr.slice(i, i + chunkSize))
  }
  const strings = chunks.map(chunk => String.fromCharCode(...chunk))
  return btoa(strings.join(''));
}

function base64ToBuffer(base64) {
  const binaryString = atob(base64);
  const len = binaryString.length;
  const bytes = new Uint8Array(len);

  for (let i = 0; i < len; i++) {
    bytes[i] = binaryString.charCodeAt(i);
  }

  return bytes.buffer;
}

// # Êñá‰ª∂-ÊãñÊãΩ‰∏ä‰º†
function dragUpload() {
  document.addEventListener('dragover', (e) => e.preventDefault())
  document.addEventListener('drop', (e) => {
    e.preventDefault()
    const file = e.dataTransfer.files?.[0]
    if (!file) return;
    const reader = new FileReader()
    reader.onload = () => {
      let cont = reader.result
      logs(cont, 'dragUpload()')
    }
    reader.readAsText(file, 'UTF-8')
  })
}

// # Êñá‰ª∂-Á≤òË¥¥‰∏ä‰º†
function pasteUpload() {
  document.addEventListener('paste', function (e) {
    var items = e.clipboardData.items
    if (!items) return;
    for (var i = 0; i < items.length; i++) {
      if (items[i].type.indexOf('image') !== -1) {
        var blob = items[i].getAsFile()
        var reader = new FileReader()
        reader.onload = function (event) {
          var img = new Image()
          img.src = event.target.result;
          document.body.appendChild(img)
        };
        reader.readAsDataURL(blob)
      }
    }
  })
}

// # Êñá‰ª∂-Ê≠£ÂàôËé∑ÂèñÊñá‰ª∂Á±ªÂûã
function getType(val) {
  if (/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)$/i.test(val)) return 'img'
  if (/\.(mp4|mpg|mpeg|dat|asf|avi|rm|rmvb|mov|wmv|flv|mkv|m3u8)$/i.test(val)) return 'video'
  if (/\.(mp3|wav|wma|aac|flac|ape|ogg|aiff|m4a|caf)$/i.test(val)) return 'audio'
  if (/\.(doc|docx|odt)$/i.test(val)) return 'doc'
  if (/\.(xls|xlsx)$/i.test(val)) return 'xls'
  if (/\.(ppt|pptx)$/i.test(val)) return 'ppt'
  if (/\.(pdf)$/i.test(val)) return 'pdf'
  if (/\.(txt|ini|properties|yml|json|md)$/i.test(val)) return 'txt'
  if (/\.(java|html|htm|css|js|php|h|go|)$/i.test(val)) return 'code'
  if (/\.(zip|rar|7z|tar\.gz|tar\.bz2)$/i.test(val)) return 'zip'
  return 'other'
}

// # Êñá‰ª∂-Ëé∑ÂèñÊñá‰ª∂Â§ßÂ∞è
function formatBytes(size) {
  const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB'];
  let exp = 0;
  while (size >= 1024) {
    size /= 1024;
    exp++;
  }
  return `${size.toFixed(1)}${units[exp]}`;
}

// # ÊµèËßàÂô®-Âä†ËΩΩscriptËÑöÊú¨
function loadScript(url, globalName) {
  return new Promise((resolve, reject) => {
    if (!url) return reject(url)
    // Â∑≤ÁªèÂä†ËΩΩËøáÊîπjs
    if (globalName && window[globalName]) {
      console.log(globalName + ' Â∑≤ÁªèË¢´Âä†ËΩΩËøá')
      return resolve(window[globalName])
    }
    const scriptEl = document.createElement('script')
    scriptEl.type = 'text/javascript'
    scriptEl.src = url
    scriptEl.onload = () => resolve(globalName && window[globalName])
    scriptEl.onerror = (e) => {
      reject(e)
    };
    (document.getElementsByTagName('head')[0] || document.body).appendChild(scriptEl)
  })
}

// # ÊµèËßàÂô®-JSONP
function getJSONP(url, options = {}) {
  return new Promise((reso, rej) => {
    const scriptEl = document.createElement('script')
    const callbackKey = options.callback || 'callback'
    const callbackName = '__callback' + Date.now() + Math.random().toString().slice(2)
    const timeout = options.timeout || 30000
    let timing = null
    function end () {
      clearTimeout(timing)
      delete window[callbackName]
      scriptEl.remove()
    }
    window[callbackName] = (res) => {
      console.log('jsonp res:', res)
      end()
      reso(res)
    }
    scriptEl.onerror = () => {
      end()
      rej()
    }
    timing = setTimeout(() => {
      end()
      rej()
    }, timeout)
    scriptEl.src = url + (url.indexOf('?') >= 0 ? '&' : '?') + callbackKey + '=' + callbackName
    document.body.appendChild(scriptEl)
  })
}

// # ÊµèËßàÂô®-Â§çÂà∂ÊñáÊú¨
function copyText(text) {
  const inputEl = document.createElement('input');
  document.body.appendChild(inputEl);
  inputEl.value = text;
  inputEl.focus();
  inputEl.select();
  document.execCommand && document.execCommand('copy');
  inputEl.parentNode.removeChild(inputEl)
  return true
}

// # ÊµèËßàÂô®-Â§çÂà∂ÊñáÊú¨
function copyEl(el) {
  getSelection().removeAllRanges()
  var range = document.createRange()
  range.selectNodeContents(el)
  getSelection().addRange(range)
  document.execCommand('copy')
  getSelection().removeAllRanges()
}

// # ÊµèËßàÂô®-Â§çÂà∂ÊñáÊú¨(https)
function copyText1(text) {
  return navigator.clipboard.writeText(text)
}


// # ÊµèËßàÂô®-Ëß£ÊûêURLÂèÇÊï∞
function url2Obj(url) {
  url = url || window.location.href
  const search = url.substring(url.lastIndexOf('?') + 1)
  const obj = {}
  search.replace(/([^?&=]+)=([^?&=]*)/g, (rs, $1, $2) => {
    obj[decodeURIComponent($1)] = String(decodeURIComponent($2))
    return rs
  })
  return obj
}

function url2Obj1() {
  return Object.fromEntries(new URLSearchParams(window.location.search))
}

// # ÊµèËßàÂô®-Â§ÑÁêÜURLÂèÇÊï∞
function tansUrlParams(params) {
  if (!params) return ''
  return new URLSearchParams(params).toString()
}

function tansParams(params) {
  if (!params) return ''
  let result = '', encURI = encodeURIComponent;
  for (const key of Object.keys(params)) {
    const value = params[key]
    if (!value && value !== 0) continue;
    if (typeof value === 'object') {
      for (const subKey of Object.keys(value)) {
        const subValue = value[subKey];
        if (!subValue && subValue !== 0) continue;
        result += `${encURI(key + '[' + subKey + ']')}=${encURI(subValue)}&`
      }
    } else {
      result += `${encURI(key)}=${encURI(value)}&`
    }
  }
  return result.slice(0, -1)
}

// # ÊµèËßàÂô®-ÂÖ®Â±è
function fullScreen(isFull, el) {
  el = el || (isFull ? document.documentElement : document)
  let rfs = el.requestFullScreen || el.webkitRequestFullScreen || 
    el.mozRequestFullScreen || el.msRequestFullScreen
  let cfs = el.cancelFullScreen || el.webkitCancelFullScreen ||
    el.mozCancelFullScreen || el.exitFullScreen
  console.log(rfs, cfs);
  if (isFull && rfs) return rfs.call(el)
  if (!isFull && cfs) return cfs.call(el)
  if (typeof window.ActiveXObject !== 'undefined') {
    var wscript = new ActiveXObject('WScript.Shell')
    wscript && wscript.SendKeys('{F11}')
  }
}

// # ÊµèËßàÂô®-Âà§Êñ≠ÊòØÂê¶ÁßªÂä®Á´Ø
function isMobile() {
  const userAgent = navigator.userAgent.toLowerCase()
  return /iphone|ipod|android|webos|blackberry|windows phone|ipad|mobile|symbian|phone|Kindle|opera mini/i.test(userAgent)
}

// # ÊµèËßàÂô®-ÂõûÂà∞È°∂ÈÉ®ÊàñÂÆö‰Ωç
function scrollTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' })
  document.getElementById('id').scrollIntoView({ behavior: 'smooth', block: 'start' }); // start center end
}

// # ÊµèËßàÂô®-ÂõæÁâáÊáíÂä†ËΩΩ
function lazyImg() {
  const observer = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target
        img.src = img.getAttribute('img-src')
        img.onload = () => { img.style.opacity = 1 }
        observer.unobserve(img)
      }
    })
  })
  Array.from(document.querySelectorAll('img[img-src]')).forEach((item) => observer.observe(item))
}

// # ÊµèËßàÂô®-storageÂ∞ÅË£Ö
function getStorage(key) {
  let result = localStorage.getItem(key)
  try {
    return JSON.parse(result)
  } catch {
    return result
  }
}
function setStorage(key, val) {
  if (!val && val !== 0) return localStorage.removeItem(key)
  localStorage.setItem(key, JSON.stringify(val))
}
function delStorage(key) {
  localStorage.removeItem(key)
}

// # ÊµèËßàÂô®-storage-gzipÂ∞ÅË£Ö
// https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js
// https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js
// localforage.config({ driver: localforage.INDEXEDDB, name: 'test-db', storeName: 'test-store' });
async function getStorageGz(key) {
  const gzdata = await localforage.getItem(key)
  if (!data) return null
  let val = null
  try {
    val = pako.inflate(gzdata, { to: 'string' });
    return JSON.parse(val)
  } catch (e) {
    return val
  }
}
function setStorageGz(key, val) {
  if (!val && val !== 0) return localforage.removeItem(key)
  let text = JSON.stringify(val)
  const data = pako.deflate(new TextEncoder().encode(text), { level: 9 });
  localforage.setItem(key, data).then(() => {
    const size = data.length / 1024;
    const size1 = new TextEncoder().encode(text).length / 1024; // ËΩ¨Êç¢‰∏∫KB
    console.log(`Â≠òÂÇ®ÊàêÂäü: ${size1.toFixed(2)}kb -> ${size.toFixed(2)}kb,  ÂéãÁº©Áéá: ${(100 * size / size1).toFixed(2)}%`);
  }).catch(console.error);
}

// # ÊµèËßàÂô®-ÁßªÈô§HTMLÊ†áÁ≠æ
function pureHtml(str) {
  if (!str) return ''
	try {
    str = decodeURI(str)
	} catch (e) {}
  str = str.replace(/<\/?[^>]*>/g, '') // ÂéªÈô§HTML tag
  str = str.replace(/[ | ]*\n/g, '\n') // ÂéªÈô§Ë°åÂ∞æÁ©∫ÁôΩ
  // str = str.replace(/\n[\s| | ]*\r/g,'\n'); //ÂéªÈô§Â§ö‰ΩôÁ©∫Ë°å
  str = str.replace(/&nbsp;/ig, '') // ÂéªÊéâÁ©∫ÁôΩ
  str = str.replace(/ /ig, '') // ÂéªÊéâÁ©∫ÁôΩ
  return str
}

// # ÊµèËßàÂô®-Âà§Êñ≠ÊòØÂê¶ÁßªÂä®Á´Ø
function isMobile() {
  const userAgent = navigator.userAgent.toLowerCase();
  // Âà§Êñ≠ÊòØÂê¶ÂåÖÂê´ÁßªÂä®ËÆæÂ§áÁöÑÊ†áÂøóÔºåÂåÖÊã¨È∏øËíôÁ≥ªÁªüÂíåÂ∞èÁ±≥ HyperOS
  return /iphone|ipod|android|webos|blackberry|windows phone|ipad|mobile|phone|Kindle|opera mini|harmonyos|hyperos/i.test(userAgent);
}


// # ÊµèËßàÂô®-Ëß£Èô§Â§çÂà∂ÈôêÂà∂
function canCopy() {
  function t(e) { e.stopPropagation(), e.stopImmediatePropagation && e.stopImmediatePropagation() }
  document.querySelectorAll("*").forEach(e => {
      "none" === window.getComputedStyle(e, null).getPropertyValue("user-select") && e.style.setProperty("user-select", "text", "important")
  }), ["copy", "cut", "contextmenu", "selectstart", "mousedown", "mouseup", "mousemove", "keydown", "keypress", "keyup"].forEach(function (e) {
      document.documentElement.addEventListener(e, t, {capture: !0})
  }), alert("Ëß£Èô§ÈôêÂà∂ÊàêÂäüÂï¶ÔºÅ")
}

// # ÊµèËßàÂô®-Êñ∞È°µÈù¢ÊâìÂºÄ‰ª£Á†Å
function openCode(code) {
  const dataUri = URL.createObjectURL(new Blob([code], { type: 'text/html;charset=utf-8' }));
  window.open(dataUri);
}

function getCodeExt(ele) {
  const extensionMap = {
    js: 'js', javascript: 'js', ts: 'ts', typescript: 'ts', py: 'py', python: 'py', java: 'java', c: 'c', sql: 'sql', vue: 'vue', nginx: 'conf',
    cpp: 'cpp', 'c++': 'cpp', cs: 'cs', csharp: 'cs',  go: 'go', php: 'php', ruby: 'rb', html: 'html', xml: 'xml', json: 'json',
    css: 'css', scss: 'scss', less: 'less', yml: 'yml', yaml: 'yaml', shell: 'sh', bash: 'sh', sh: 'sh', bat: 'bat', batch: 'bat',
  };
  if (!ele || !ele.classList) return '';
  let key = Object.keys(extensionMap).find(x => ele.classList.contains(x) || ele.classList.contains(`language-${x}`))
  return key ? ('.' + extensionMap[key]) : '.txt'
}
function loadFromStorage () {
  const html = localStorage.getItem('runHtml');
  if (html) {
    document.write(html);
    document.close();
  } else {
    document.write('<h1 style="text-align: center; padding: 30px;">ÊöÇÊó†ÂèØËøêË°å‰ª£Á†Å!</h1>');
  }
};

// # ServiceWorker.js ÁºìÂ≠ò
function serviceWorkerJs() {
  // Âä†ËΩΩsw.jsÊñá‰ª∂
  ;('serviceWorker' in navigator) && window.addEventListener('load', () => navigator.serviceWorker.register('sw.js').then(e => console.log('[SW-CHAT] Service Worker success:', e)));
  // sw.jsÊñá‰ª∂ÂÜÖÂÆπ
  const CACHE_NAME = 'CHAT-CACHE-V3';
  const URLS_TO_CACHE = [ '/', '/index.html', '/index.css', '/index.js' ];

  self.addEventListener('install', event => {
    console.log(`[SW-CHAT] Event: install (version: ${CACHE_NAME})`);
    event.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(URLS_TO_CACHE))
      .then(() => self.skipWaiting()).catch(e => console.error('[SW-CHAT] Precaching failed:', e))
    );
  });

  self.addEventListener('activate', event => {
    console.log(`[SW-CHAT] Event: activate (version: ${CACHE_NAME})`);
    event.waitUntil(
      caches.keys().then(cacheNames => Promise.all(cacheNames.map(cacheName => cacheName !== CACHE_NAME && caches.delete(cacheName))))
        .then(() => self.clients.claim())
    )
  });

  self.addEventListener('fetch', event => {
    const { request } = event;
    if (request.method !== 'GET' || request.url.includes('cdn')) return;
    event.respondWith(
      caches.match(request).then(cachedResponse => cachedResponse || fetch(request)).catch(() => {})
    );
  });
}


// # css-ÊªöÂä®Êù°
// ::-webkit-scrollbar { width: 8px; height: 8px; }
// ::-webkit-scrollbar-thumb {	background-color: #ddd;	border-radius: 6px; }

// # Â∑•ÂÖ∑-Èò≤Êäñ
// ‰∏ÄÂÆöÊó∂Èó¥ÂÜÖÔºåÂè™ÊúâÊúÄÂêé‰∏ÄÊ¨°Êìç‰ΩúÔºåÂÜçËøáwaitÊØ´ÁßíÂêéÊâçÊâßË°åÂáΩÊï∞
function debounce(fn, delay, isImmediate) { 
  let timer = null;
  return function() { 
    const context = this;
    let args = arguments;
    clearTimeout(timer);
    if(isImmediate && timer === null) {
      fn.apply(context, args);
      timer = 0;
      return;
    }
    timer = setTimeout(() => { 
      fn.apply(context, args);
      timer = null;
    }, delay);
  }
}

// # Â∑•ÂÖ∑-Âä†ÂØÜËß£ÂØÜÊï∞Â≠ó
function encryptNum (num) {
  const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
  let base35 = parseInt(num).toString(35); // ËøõÂà∂20-36Ëá™ÂÆö‰πâ
  const ind = parseInt(base35.charAt(0), 36) % 2 + 1; // ÈöèÊú∫ÊèíÂÖ•Â≠óÁ¨¶Á¥¢Âºï
  base35 = base35.slice(0, ind) + chars[Math.floor(Math.random() * chars.length)] + base35.slice(ind);
  return base35.toUpperCase();
}
// Ëß£ÂØÜÊï∞Â≠ó
function decryptNum (val) {
  const ind = parseInt(val.charAt(0), 36) % 2 + 1;
  const decryptedStr = val.slice(0, ind) + val.slice(ind + 1);
  return parseInt(decryptedStr, 35);
}


// # Â∑•ÂÖ∑-ËäÇÊµÅ
// Âú®‰∏ÄÂÆöÊó∂Èó¥ÂÜÖÔºåÂè™ËÉΩËß¶Âèë‰∏ÄÊ¨°
function throttle(fn, delay) { 
  let lastTime = Date.now();
  return function() { 
    let args = arguments;
    const now = Date.now();
    if(now - lastTime >= delay){
      lastTime = now;
      fn.apply(this, args);
    }
  }
}

// # Â∑•ÂÖ∑-Ê∑±Â∫¶ÂÖãÈöÜ
function deepClone(obj) {
	if ([null, undefined, NaN, false].includes(obj)) return obj
	if (typeof obj !== 'object' && typeof obj !== 'function') { // ÂéüÂßãÁ±ªÂûãÁõ¥Êé•ËøîÂõû
		return obj
	}
	const o = isArray(obj) ? [] : {}
	for (const i in obj) {
		if (obj.hasOwnProperty(i)) {
			o[i] = typeof obj[i] === 'object' ? deepClone(obj[i]) : obj[i]
		}
	}
	return o
}

// # Â∑•ÂÖ∑-Ê†ºÂºèÂåñÊó•Êúü
function timeFormat(date, formatStr = 'yyyy-MM-dd HH:mm:ss') {
  date = date || new Date()
	const timeSource = {
		'y': date.getFullYear().toString(), // Âπ¥
		'M': (date.getMonth() + 1).toString().padStart(2, '0'), // Êúà
		'd': date.getDate().toString().padStart(2, '0'), // Êó•
		'H': date.getHours().toString().padStart(2, '0'), // Êó∂
		'h': date.getHours().toString().padStart(2, '0'), // Êó∂
		'm': date.getMinutes().toString().padStart(2, '0'), // ÂàÜ
		's': date.getSeconds().toString().padStart(2, '0') // Áßí
	}
  for (const key in timeSource) {
    const [ret] = new RegExp(`${key}+`).exec(formatStr) || []
    if (ret) {
      // Âπ¥ÂèØËÉΩÂè™ÈúÄÂ±ïÁ§∫‰∏§‰Ωç
      const beginIndex = key === 'y' && ret.length === 2 ? 2 : 0
      formatStr = formatStr.replace(ret, timeSource[key].slice(beginIndex))
    }
  }
  return formatStr
}

// # Â∑•ÂÖ∑-Ëß£ÊûêÊó•Êúü
function timeParse(str, formatStr) {
  if (formatStr) { // ÂøÖÈ°ªÂåÖÂê´Âπ¥ÊúàÊó•
    if (!/(?=.*yyyy)(?=.*MM)(?=.*dd).*/.test(formatStr)) return null;
    const regex = new RegExp(formatStr.replace(/yyyy/, '(\\d{4})').replace(/MM|dd/g, '(\\d{2})').replace(/HH|mm|ss/g, '(\\d{2})'));
    const matches = str.match(regex);
    if (!matches) return null;
    const year = matches[1], month = matches[2] - 1, day = matches[3];
    const hour = matches[4] || 0, minute = matches[5] || 0, second = matches[6] || 0;
    return new Date(year, month, day, hour, minute, second);
  }
  // Ëã•Êú™‰º†ÂÖ•formatStrÔºåÂàôÁî®new Date(str) Ëß£Êûê
  if (!str) return null
  // Ëã•‰∏∫unixÁßíÊó∂Èó¥Êà≥ÔºåÂàôËΩ¨‰∏∫ÊØ´ÁßíÊó∂Èó¥Êà≥
  if (/^\d{10}$/.test(str?.toString().trim())) 
    return new Date(str * 1000)
  // Ëã•Áî®Êà∑‰º†ÂÖ•Â≠óÁ¨¶‰∏≤Ê†ºÂºèÊó∂Èó¥Êà≥Ôºånew DateÊó†Ê≥ïËß£ÊûêÔºåÈúÄÂÅöÂÖºÂÆπ
  if (typeof str === 'string' && /^\d+$/.test(str.trim())) 
    return new Date(Number(str))
	// Â§ÑÁêÜÂπ≥Âè∞ÊÄßÂ∑ÆÂºÇÔºåÂú®Safari/Webkit‰∏≠Ôºånew Date‰ªÖÊîØÊåÅ/‰Ωú‰∏∫ÂàÜÂâ≤Á¨¶ÁöÑÂ≠óÁ¨¶‰∏≤Êó∂Èó¥
	if (typeof str === 'string' && str.includes('-') && !str.includes('T'))
		return new Date(str.replace(/-/g, '/'))
	// ÂÖ∂‰ªñÈÉΩËÆ§‰∏∫Á¨¶Âêà RFC 2822 ËßÑËåÉ
	return new Date(str)
}

// # Â∑•ÂÖ∑-ÈìæÂºèÈÄíÂΩíÂú∞Ëé∑ÂèñÂØπË±°ÂµåÂ•óÂ±ûÊÄßÁöÑÂÄº
function getChildObj(obj, chain) {
  if (!obj || typeof obj !== 'object' || !chain || !chain.trim()) {
    return obj;
  }
  const keys = chain.split('.').map(x=>x.trim()).filter(Boolean);
  return keys.reduce((currObj, key) => currObj?.[key], obj);
}

// # Â∑•ÂÖ∑-Promise‰ªªÊÑè
function anyPromise(promises) {
  if (!promises.length) throw new Error("No Promise passed");

  return new Promise((resolve, reject) => {
    let errCount = 0, errs = [];
    promises.forEach((promise, index) => promise
      .then(data => resolve(data))
      .catch(err => {
        errs[index] = err;
        if (++errCount === promises.length) reject(new Error('No Promise resolved', errs))
      })
    )
  })
}

// # Â∑•ÂÖ∑-Ëé∑ÂèñÂÖ¨ÁΩëIP
function getPublicIp() {
  let proto = location.protocol === 'file:' ? 'http:' : location.protocol
  let urls = ['//ipv4.ipw.cn/api/ip/myip', '//4.ipw.cn', '//ifconfig.me/ip', '//myexternalip.com/raw'] //, 'http://ident.me', 'https://api.ipify.org'
  const fetchIp = (url) => new Promise((resolve) => {
    let startTime = Date.now()
    fetch(url).then(res => res.text()).then((data) => {
      if (data && data.length) {
        let arr = data.match(/([1-9][0-9]{0,2}\.){3}[1-9][0-9]{0,2}/ig)
        if (arr && arr.length) resolve({ip: arr[0], url: url, time: Date.now() - startTime})
      }
    }).catch(() => '')
  })

  return anyPromise(urls.map(url => fetchIp(`${proto}${url}`))).then(res => {
    console.log('******getPublicIp***', res);
    return res
  })
}

// # Â∑•ÂÖ∑-Ëá™ÂÆö‰πâËΩ¨Êï¥Êï∞Â∞èÊï∞
function getValType(val) {
  return Object.prototype.toString.call(val).slice(8, -1).toLowerCase();
}
function parseFloatMy(val) {
  if (getValType(val) === 'undefined' || val === '' || isNaN(val)) return 0;
  return parseFloat(val);
}
function parseIntMy(val) {
  if (getValType(val) === 'undefined' || val === '' || isNaN(val)) return 0;
  return parseInt(val);
}

// # Â∑•ÂÖ∑-ÂÖ®Â±Ä‰∫ã‰ª∂ÊÄªÁ∫ø
class EventBus {
  constructor() {
    this.events = {}
  }
  // Ê≥®ÂÜå‰∫ã‰ª∂
  on(eventName, callback) {
    if (!this.events[eventName]) {
      this.events[eventName] = []
    }
    this.events[eventName].push(callback)
  }
  // Ëß¶Âèë‰∫ã‰ª∂
  emit(eventName, ...args) {
    if (this.events[eventName]) {
      this.events[eventName].forEach((callback) =>  callback(...args))
    }
  }
  // Ê≥®ÈîÄ‰∫ã‰ª∂
  off(eventName, callback) {
    if (this.events[eventName]) {
      this.events[eventName] = this.events[eventName].filter((cb) => cb !== callback)
    }
  }
}
window.$eventBus = new EventBus()


// # vue-ÂÖ®Â±ÄÊ≥®ÂÜå
function vue3Global(app) {
  app.config.globalProperties.$goPage = goPage
  app.component('Test', Test)
  Vue.prototype.$goPage = goPage
  Vue.component('Test', Test)
}

// # uni-È°µÈù¢Ë∑≥ËΩ¨
function goPage(url, type, timeout) {
  if (!url) return
  // uni.setStorageSync(url.split('?')[0].replaceAll('/', '_'), getUrlParamsByReg(url))
  if (timeout) {
    setTimeout(() => goPageDo(url, type), timeout)
  } else {
    goPageDo(url, type)
  }
}
function goPageDo(url, type) {
  if (!url) return
  const isTabBar = false
  if (!type) type = isTabBar ? 'switch' : 'navigate'
  type = (type + '').toLowerCase()
  console.log('$goPage', url, type);
  // ËøîÂõû‰∏änÁ∫ß, Ë¥üÊï∞Ëá™Âä®ËΩ¨Âåñ‰∏∫Ê≠£
  if (Number.isInteger(url)) return uni.navigateBack({ delta: Math.abs(url) })
  // Ë∑≥ËΩ¨È°µÈù¢
  if (type === 'navigate' || type === 'navigateto') return uni.navigateTo({ url })
  // ÈáçÂÆöÂêë
  if (type === 'redirect' || type === 'redirectto') uni.redirectTo({ url })
  // ÈáçÊñ∞ÊâìÂºÄ
  if (type === 'relaunch') uni.reLaunch({ url })
  // ÈáçÂÆöÂêë
  if (type === 'switch' || type === 'switchtab') uni.switchTab({ url })
}

// # uni-Â∫ïÈÉ®ÂàÜÈ°µÂä†ËΩΩ
function uniBottomPageLoad() {
  return {
    data: {
      dataStatus: 'loadmore', // loadmore: Âä†ËΩΩÊõ¥Â§ö, nomore: Ê≤°ÊúâÊõ¥Â§ö , loading: Ê≠£Âú®Âä†ËΩΩ
      dataList: [],
      params: { page: 1, limit: 10 }
    },
    onReachBottom() {
      this.getDataList()
    },
    methods: {
      getDataList() {
        if (this.dataStatus === 'loading' || this.dataStatus == 'nomore') return;
        this.dataStatus = 'loading'
        Api.getXXXList({ ...this.params }).then(res => {
          if (res.success) {
            this.dataList = this.dataList.concat((res.data || []).map(item => ({ ...item })))
            this.params.page++;
          }
          this.dataStatus = res.data && res.data.length ? 'loadmore' : 'nomore'
        }).catch(() => this.dataStatus = 'loadmore')
      },
    }
  }
}

// # uni-request
function uniRequest(getToken) {
  const timeout = 30000
  const baseUrl = config.baseUrl // import.meta.env.VITE_APP_BASE_API  process.env.VUE_APP_BASE_API

  const request = config => {
    config.header = config.header || {}
    if (getToken() && !config.noToken) {
      config.header['Authorization'] = 'Bearer ' + getToken()
    }
    if (config.params) {
      config.url = ((config.url.includes('?') ? '&' : '?') + tansParams(config.params))
    }
    return new Promise((resolve, reject) => {
      uni.request({
        method: config.method || 'GET',
        timeout: config.timeout ||  timeout,
        url: config.url.startsWith('http') ? config.url : (baseUrl + config.url),
        data: config.data,
        header: config.header,
        // dataType: 'json',
        success(res) {
          if (res.statusCode === 200) {
            resolve(res.data || {})
            // ÂÖ∂‰ªñÈ°πÁõÆÁ∫ßÂà´ËøîÂõûcodeËá™Ë°åÂ§ÑÁêÜ
          } else {
            uni.showToast({ title: 'ÂêéÁ´ØÊé•Âè£' + res.statusCode + 'ÂºÇÂ∏∏', icon: 'none' })
            reject('ÂêéÁ´ØÊé•Âè£' + res.statusCode + 'ÂºÇÂ∏∏')
          }
        },
        fail(err) {
          console.log(err)
          uni.showToast({ title: 'ÂêéÁ´ØÊé•Âè£ËØ∑Ê±ÇÈîôËØØ', icon: 'none' })
          reject(err)
        }
      })
    })
  }
  request.get = (url, config = {}) => request({ url, ...config })
  request.put = (url, data, config = {}) => request({ url, method: 'PUT', data,  ...config })
  request.post = (url, data, config = {}) => request({ url, method: 'POST', data,  ...config })

  // export default request
}

// # Ê≠£Âàô-‰∏≠Êñá
function isChinese(val) {
  return (/^[\u4e00-\u9fa5]+$/gi).test(val)
}

// # Ê≠£Âàô-Â≠óÊØçÊï∞Â≠ó
function isEnNum(val) {
  return (/^[0-9a-zA-Z]*$/g).test(val)
}

// # Ê≠£Âàô-ÊâãÊú∫Âè∑
function isEnNum(val) {
  return /^1[3-9]\d{9}$/.test(val)
}

// # Ê≠£Âàô-ÈÇÆÁÆ±
function isEmail(val) {
  return /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(val)
}

// # Ê≠£Âàô-ipv4
function isIpv4(val) {
  return (/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/).test(val)
}

// # Ê≠£Âàô-ipv6
function isIpv6(val) {
  return (/^([\da-fA-F]{1,4}:){6}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^::([\da-fA-F]{1,4}:){0,4}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^([\da-fA-F]{1,4}:):([\da-fA-F]{1,4}:){0,3}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^([\da-fA-F]{1,4}:){2}:([\da-fA-F]{1,4}:){0,2}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^([\da-fA-F]{1,4}:){3}:([\da-fA-F]{1,4}:){0,1}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^([\da-fA-F]{1,4}:){4}:((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^([\da-fA-F]{1,4}:){7}[\da-fA-F]{1,4}$|^:((:[\da-fA-F]{1,4}){1,6}|:)$|^[\da-fA-F]{1,4}:((:[\da-fA-F]{1,4}){1,5}|:)$|^([\da-fA-F]{1,4}:){2}((:[\da-fA-F]{1,4}){1,4}|:)$|^([\da-fA-F]{1,4}:){3}((:[\da-fA-F]{1,4}){1,3}|:)$|^([\da-fA-F]{1,4}:){4}((:[\da-fA-F]{1,4}){1,2}|:)$|^([\da-fA-F]{1,4}:){5}:([\da-fA-F]{1,4})?$|^([\da-fA-F]{1,4}:){6}:$/).test(val)
}

// # Ê†°È™å-ÊòØÂê¶ÂØπË±°
function isObject(val) {
  return Object.prototype.toString.call(val) === '[object Object]'
}

// # ÈöèÊú∫Â≠óÁ¨¶‰∏≤
function randomStr(len) {
  return Math.random().toString(32).slice(-len)
}

// # Êó•Êúü‰∏≤
function dateStr(len) {
  return new Date().toLocaleString('zh-CN', { hour12: false }).replace(/\D/ig, '')
}

// # ÂÖ∂‰ªñ-Ëá™ÂÆö‰πânotify
window.dnotifyTimer = null; window.dnotifyEl = document.body.appendChild(Object.assign(document.createElement('div'), { 
  id: 'dnotify', style: `display:none; min-width: 260px;max-width: 40%; padding: 10px; box-sizing: border-box; border: 1px solid #ebeef5; text-align: center; color:#333;
    position: fixed; background-color: #fff; top:16px;right:16px;z-index: 9999999; font-size: 14px;line-height: 1.4; border-radius: 8px; box-shadow: 0 2px 12px 0 rgba(0,0,0,.1); `
}));
function dnotify(txt, time) {
  dnotifyEl.style.display = 'block';
  dnotifyEl.innerHTML = txt;
  clearTimeout(dnotifyTimer);
  dnotifyTimer = setTimeout(() => dnotifyEl.style.display = 'none', (time || 3) * 1000);
}

function logs(val, title) {
  title && console.log("%c --- " + title + ' start log ---', 'background: #409EFF;color:#fff;padding:2px 4px;font-size:14px;')
  console.log(val);
  title && console.log("%c --- " + title + ' end log ---', 'background: #409EFF;color:#fff;padding:2px 4px;font-size:14px;')
}
</script>
<!-- ************************************************************* jsCont ************************************************************* -->

  <script>
    function $q(val) { return document.querySelector(val) }
    function $qa(val) { return Array.from(document.querySelectorAll(val)) }
    function random(val, len) { return md5(val).slice(0, len || 4) }

    async function main() {
      // const jsData = await fetch('./javascript.js').then(res => res.text()).catch(() => '')
      jsData = $q('#jsCont').innerHTML
      $q('#cont-js').innerHTML = '\n' + jsData.trim()
      $q('#cont-js').parentNode.style.display = jsData ? 'block' : 'none'
      $q('#cont-bat').innerHTML = window.batJs.trim()
      $q('#cont-bat').parentNode.style.display = window.batJs ? 'block' : 'none'
      $q('#cont-bash').innerHTML = window.bashJs.trim()
      $q('#cont-bash').parentNode.style.display = window.bashJs ? 'block' : 'none'
      $q('#cont-nginx').innerHTML = window.nginxJs.trim()
      $q('#cont-nginx').parentNode.style.display = window.nginxJs ? 'block' : 'none'
      $q('#cont-css').innerHTML = window.cssJs.trim()
      $q('#cont-css').parentNode.style.display = window.cssJs ? 'block' : 'none'

      Prism.highlightAll()

      await new Promise(resolve => setTimeout(resolve, 600))

      let titleObj = [
        { title: 'JavaScript', list: [], reg: /^\s*\/\/\s*#/ },
        { title: 'BatËÑöÊú¨', list: [], reg: /^\s*::\s*#/ },
        { title: 'BashËÑöÊú¨', list: [], reg: /^\s*#\s*#/ },
        { title: 'nginxÈÖçÁΩÆ', list: [], reg: /^\s*#\s*@/ },
        { title: 'CssÊ†∑Âºè', list: [], reg: /^\s*\/\*\*\*\s*/ },
      ]
      $qa('.token.comment').forEach(item => {
        const text = item.innerText
        let ind = titleObj.findIndex(x => x.reg.test(text))
        if (ind > -1) {
          let title = text.replace(titleObj[ind].reg, '').trim()
          item.classList.add('title')
          item.id = 'c_' + random(title)
          titleObj[ind].list.push(title)
          console.log(text, ind, item);
        }
      })
      titleObj.forEach(item => {
        if (item.list.length) {
          const splitEl = document.createElement('div')
          splitEl.className = 'spliter'
          splitEl.innerHTML = ' - ' + item.title
          $q('#title-list').appendChild(splitEl)
          const titleBox = document.createElement('div')
          titleBox.className = 'title-box'
          item.list.forEach((x, ind) => {
            const div = document.createElement('div')
            div.innerHTML = `<a href="#c_${random(x)}">${ind + 1}. ${x}</a>`
            titleBox.appendChild(div)
          })
          $q('#title-list').appendChild(titleBox)
          // Â∞è‰∫é5‰∏çÂ±ïÂºÄÔºåÂ§ß‰∫é5ÁÇπÂºÄÊäòÂè†ÔºåÂ§ß‰∫é20ÈªòËÆ§ÊäòÂè†
          item.list.length > 5 && splitEl.addEventListener('click', () => {
            titleBox.style.height = '0px' === titleBox.style.height ? 'auto' : '0px' 
          })
          item.list.length > 20 && (titleBox.style.height = '0px');
        }
      })

      location.hash && document.querySelector(location.hash)?.scrollIntoView({ behavior: 'smooth' });
      toggleTheme(true)
      'none' == localStorage.getItem('utils-tools') && toggleTool(true)
    }

    main()

    function toggleTheme(isLocal) {
      let themeLink = document.querySelector("link[href*='min.css']");
      const isDark = isLocal === true ? localStorage.getItem('utils-theme') == 'light' : themeLink.href.includes('dark')
      themeLink.href = isDark ? 'https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/prism/1.29.0/themes/prism.min.css'
        : 'https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/prism-themes/1.9.0/prism-vsc-dark-plus.min.css';
      $q('#tool-theme').innerText = isDark ? '‚òÄÔ∏è' : 'üåô'
      localStorage.setItem('utils-theme', isDark ? 'light' : 'dark')
    }

    function toggleTool(isHide) {
      const tools = $q('#title-list')
      tools.style.display = isHide ? 'none' : 'none' === tools.style.display ? 'block' : 'none';
      localStorage.setItem('utils-tools', tools.style.display)
    }

    try {
      // ÊµãËØïÂáΩÊï∞
      // dragUpload()
    } catch (e) { console.log(e); }

  </script>
</body>
</html>